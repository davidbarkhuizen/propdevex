<!doctype html>
<html lang="en" ng-app='geoNodeTekApp' >
	<head>
		<meta charset="utf-8">
		<title>GeoNodeTek</title>

		<link rel="stylesheet" type="text/css" href="/static/css/geonodetek.css" />
	    <script src="/static/lib/js/angular/angular.1.3.15.js"></script>

	    <!-- true lib code -->
		<script src="/static/js/lib.js"></script>
	    <script src="/static/js/gps.js"></script>

	    <script src="/static/js/const.js"></script>
	    
	    <script src="/static/js/controllers/events.js"></script>

		<script src="/static/js/controllers/god.controller.js"></script>
		<script src="/static/js/controllers/gpximport.controller.js"></script>
		<script src="/static/js/controllers/trackinfos.controller.js"></script>
	    <script src="/static/js/controllers/waypoints.controller.js"></script>
	    <script src="/static/js/controllers/map.controller.js"></script>
		<script src="/static/js/controllers/elevationplot.controller.js"></script>
		<script src="/static/js/controllers/tracks.controller.js"></script>
		
		<script src="/static/js/app.js"></script>
	</head>
	<body ng-controller="GodController">

		<div id="wrapper">

		    <div id="top">
		        <div id="topleft">
		        </div>
		        <div id="topright">
		        	{{ headerText }}
	        	</div>
		    </div>

		    <div id="middle">
		        <div id="middleleft">

			        <div
			        	class='margin-right-10px'
			        	>

		           		<a ng-class='active' href='#' ng-click='launchGpxImport();'>import gpx file</a>
		           		<br/>
		           		<br/>

						<a
							class="active"
							href='#'
							ng-click='gotoOpenTrack();'>
							open track
						</a>
		           		<br/>
						<a  ng-class="(tracks.length == 0) ? 'inactive' : 'active'"
							href='#'
							ng-click='gotoAddTrack();'>
							add track
						</a>
						<br/>	
						<a ng-class="(tracks.length > 1) ? 'active' : 'inactive'"
							href='#' 
							ng-click='gotoUnloadTrack();'>
							unload track
						</a>
						<br/>	           		
		           		
		           		<br/>

		           		<!-- MAP -->
				        <a ng-class="(tracks.length > 0) && (view !== Views.MAP) ? 'active' : 'inactive'" href='#' ng-click='gotoMap();'>map</a>
		           		<br/>
						<a ng-class="(view == Views.MAP) ? 'active' : 'inactive'" href='#' ng-click='cancelMapSelection();'>cancel selection</a>
						<br/>
						<a ng-class="(view == Views.MAP) ? 'active' : 'inactive'" href='#' ng-click='zoomIn();'>zoom in</a>
						<br/>
						<a ng-class="(view == Views.MAP) ? 'active' : 'inactive'" href='#' ng-click='zoomOut();'>zoom out</a>
						<br/>

						<br/>

						<a ng-class="(tracks.length > 0) && (view !== Views.STATS) ? 'active' : 'inactive'" href='#' ng-click='gotoStats()'>stats</a>
						<br/>
						<a ng-class="(tracks.length > 0) && (view !== Views.ELEVATION) ? 'active' : 'inactive'" href='#' ng-click='gotoElevationPlot();'>elevation plot</a>
						<br/>
						<a ng-class="(view !== Views.WAYPOINTS) && (tracks.length > 0) ? 'active' : 'inactive'" href='#' ng-click='gotoWaypoints()'>waypoints</a>
								   
		           	</div>

		        </div>
		        <div id="middleright">

		        	<!-- HOME -->
		        	<div
		        		id='HomeContainer'
		        		class='home'
		        		ng-show='view == Views.HOME'>

		        		<br/>
		        		david barkhuizen 2015
		        	</div>

					<!-- IMPORT -->
	            	<div id="ImportContainer"
	            		ng-show='view == Views.IMPORT'
	            		ng-controller='GpxImportController'>

		           		<div>
		           			<input
		           				id="ImportGpxFileInput"
		           				type="file"
		           				multiple
		           				name="file"/>
		           			<br/>
							<button ng-click="importSelectedFiles()">
								import selected file
							</button>
		           		</div>
	           		</div>

		        	<!-- TRACK LIST -->
	          		<div
	          			ng-show='view == Views.MAP_LIST'
	          			ng-controller='TrackInfosController'
	          			id='TrackListContainer'
	          			>

						<input
							id='TrackListFilterToken'
							placeholder='type here to filter map list and auto-select a map' 
							ng-model='searchToken' 
							ng-keyup='filter();' 
							type='text'
							size='32'
							class='dashed-line-text-input'
							ng-class='(searchToken == "") || (filteredTrackInfos.length == 0) ? "action-required" : "no-action-required"'
							/>

		            	<div class='list'>
							<div ng-repeat="trackInfo in filteredTrackInfos">
								<span 
									ng-class='((selectedTrackInfo !== null) && (selectedTrackInfo.id == trackInfo.id)) ? "selected-text" : "";'
									ng-click='select(trackInfo.id);'
									>
									{{ trackInfo.timestamp + ' ' + trackInfo.name.toLowerCase() }}
								</span>
							</div>
						</div>
					</div>
					
					<!-- LOADED TRACKS -->
	            	<div
	            		ng-show='view == Views.LOADED_TRACKS'
	            		ng-controller='TracksController'>

        				<br/>	            		
	            		<div ng-repeat="track in $parent.tracks">
	            			<a href='#' ng-click='unload(track.id)'style='color:red'>unload</a>&nbsp;<a href='#' style='color:{{track.colour}}'>{{ track.name }}</a>
        				</div>
	            	</div>

	           		<!-- MAP -->
					<div id='mapContainer'
						ng-show='view == Views.MAP'
						ng-controller='MapController'
						>

						<canvas id="MapCanvas"
							class="map-canvas">
						</canvas>

						<div id='MapSelectionArea' 
							class='map-selection-area'
							ng-show='showMapSelectionArea'
							>
						</div>

					</div>

					<!-- TRACK STATS -->
					<div id='Stats'
						ng-show='view == Views.STATS'
						class='track-stats'
						>

						<div>

							<div ng-repeat="track in tracks">
								<div style='color:{{track.colour}};'>
									<br/>
									{{ track.name }}
									<br/>
									{{ (track.totalDistanceM / 1000.0).toFixed(2) }} km
									<br/>
									total ascent = {{ track.eleDiff.toFixed(0) }} m ({{ track.minMaxEle.min.toFixed(0) }} - {{ track.minMaxEle.max.toFixed(0) }})
									<br/>
									{{ track.durationString }}
								</div>
							</div>

						</div>

					</div>

					<!-- ELEVATION PLOT -->
					<div id='ElevationContainer'
						ng-show='view == Views.ELEVATION'
						class='elevation-plot-container'
						ng-controller='ElevationPlotController'
						>

						<canvas id="ElevationPlotCanvas"
							class="elevation-canvas">
						</canvas>					
					</div>

					<div id='WaypointsContainer' 
						ng-show='view == Views.WAYPOINTS'
						ng-controller='WaypointsController'
						
						style='vertical-align:top;'
						>

						<br/>

						<div ng-show='waypoints.length > 0'>
							<div>
								{{ selectedPoint.name }}
								<br/>	
								lat {{ selectedPoint.lat }}, lon {{ selectedPoint.lon }}
								<br/>
								{{ timeString(selectedPoint.time) }}
							</div>
							<div>
								<a href='#' style='color:green;'>edit</a>
								<a href='#' style='color:red;' ng-click='promptForDeleteConfirmation = true'>delete</a>
							</div>
							<div ng-show='promptForDeleteConfirmation'>
								<br/>
								<div style='color:red;'>
									are you sure that you want to delete waypoint '{{ selectedPoint.name }}' ?
								</div>
								<div>
									<a href="#" ng-click='delete(selectedPoint.id)'>yes</a>
									<a href="#" ng-click='promptForDeleteConfirmation = false'>no</a>
								</div>
							</div>
						</div>
						<br/>
						<div>
							{{ waypoints.length }} points, in the vicinity of {{ tracks.length }} track(s):
						</div>
						<br/>
						<div class='short-list'>
							<div ng-repeat='waypoint in waypoints'>
								<span>{{ waypoint.lat.toFixed(6) }}, {{ waypoint.lon.toFixed(6) }}</span>
								<a href='#' ng-click="selectPoint(waypoint)">{{ waypoint.name }} </a>
							</div>
						</div>
					</div>

					<div id='Debug'
						ng-show='view == Views.DEBUG'>
						<div class='short-list'>
							<div id="DebugSummary">
							</div>
						</div>
						<div class='short-list'>
							<div id="DebugTrace">
							</div>
						</div>
					</div>
	        	</div>
		    </div>

		    <div id="bottom">
		        <div id="bottomleft">	
     	
		        </div>
		        <div id="bottomright">
		        	{{ infoText }}
		        </div>
		    </div>
		</div>

	</body>
</html>